<div class="relative h-full">
  <div class="pb-2 mb-4">
      <h3 class="font-semibold text-[var(--lt-text-primary,theme(colors.gray.800))]" [style.fontSize]="'var(--lt-font-modal-title, 18px)'">Correlation Analysis</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
          <div>
              <label class="block font-medium text-[var(--lt-text-primary,theme(colors.gray.700))]" [style.fontSize]="'var(--lt-font-modal-content, 14px)'">X-Axis</label>
              <select [ngModel]="state()().fieldX" (ngModelChange)="onFieldXChange($event)" class="mt-1 block w-full pl-3 pr-8 py-1.5 border border-transparent hover:border-[var(--lt-border-default,theme(colors.slate.300))] focus:outline-none focus:ring-[var(--lt-border-editing,theme(colors.blue.500))] focus:border-[var(--lt-border-editing,theme(colors.blue.500))] rounded-[10px] bg-[var(--lt-input-bg,white)] text-[var(--lt-text-primary,inherit)]" [style.fontSize]="'var(--lt-font-input, 14px)'">
                  <option value="null">Select Field</option>
                  @for (col of numericColumns(); track col.value) { <option [value]="col.value">{{ col.label }}</option> }
              </select>
          </div>
          <div>
              <label class="block font-medium text-[var(--lt-text-primary,theme(colors.gray.700))]" [style.fontSize]="'var(--lt-font-modal-content, 14px)'">Y-Axis</label>
              <select [ngModel]="state()().fieldY" (ngModelChange)="onFieldYChange($event)" class="mt-1 block w-full pl-3 pr-8 py-1.5 border border-transparent hover:border-[var(--lt-border-default,theme(colors.slate.300))] focus:outline-none focus:ring-[var(--lt-border-editing,theme(colors.blue.500))] focus:border-[var(--lt-border-editing,theme(colors.blue.500))] rounded-[10px] bg-[var(--lt-input-bg,white)] text-[var(--lt-text-primary,inherit)]" [style.fontSize]="'var(--lt-font-input, 14px)'">
                  <option value="null">Select Field</option>
                  @for (col of numericColumns(); track col.value) { <option [value]="col.value">{{ col.label }}</option> }
              </select>
          </div>
          <div>
              <label class="block font-medium text-[var(--lt-text-primary,theme(colors.gray.700))]" [style.fontSize]="'var(--lt-font-modal-content, 14px)'">Categorize by</label>
              <select [ngModel]="state()().categoryField" (ngModelChange)="onCategoryFieldChange($event)" class="mt-1 block w-full pl-3 pr-8 py-1.5 border border-transparent hover:border-[var(--lt-border-default,theme(colors.slate.300))] focus:outline-none focus:ring-[var(--lt-border-editing,theme(colors.blue.500))] focus:border-[var(--lt-border-editing,theme(colors.blue.500))] rounded-[10px] bg-[var(--lt-input-bg,white)] text-[var(--lt-text-primary,inherit)]" [style.fontSize]="'var(--lt-font-input, 14px)'">
                  <option value="null">None</option>
                  @for (col of categoryOptions(); track col.value) { <option [value]="col.value">{{ col.label }}</option> }
              </select>
          </div>
      </div>
  </div>
  <h4 class="text-center font-medium text-[var(--lt-text-primary,theme(colors.gray.700))] mb-2 truncate" [style.fontSize]="'var(--lt-font-modal-content, 14px)'">{{ chartTitle() }}</h4>
  <div #correlationChartContainer class="w-full h-[400px]"></div>
  <div #statsTooltip class="fixed opacity-0 pointer-events-none z-[120] bg-slate-800 text-white text-sm rounded-md shadow-lg p-2 leading-tight transition-opacity duration-200 max-w-xs" [style.font-family]="'var(--lt-font-family-mono, monospace)'"></div>
</div>